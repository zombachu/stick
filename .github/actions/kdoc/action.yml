name: 'Push to stick-kdoc'
runs:
  using: "composite"
  steps:
    - name: Generate kdoc
      shell: bash
      run: |
        ./gradlew dokkaHtmlMultiModule

    - name: Clone public repo
      uses: actions/checkout@v5
      with:
        persist-credentials: false
        repository: zombachu/stick-kdoc
        path: stick-kdoc
        token: ${{ inputs.token }}
        fetch-depth: 0

    - name: Copy files from my-library to public repo
      shell: bash
      run: |
        cp -r build/dokka/html stick-kdoc
        mv stick-kdoc/html stick-kdoc/docs

    - name: Commit files
      shell: bash
      run: |
        cd stick-kdoc
        git config --local user.email "zombachu@gmail.com"
        git config --local user.name "zombachu"
        git add docs
        git commit -a -m "Update kdoc"

    - name: Push to stick-kdoc
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ inputs.token }}
        repository: zombachu/stick-kdoc
        directory: stick-kdoc
        force: true

inputs:
  token:
    description: 'SSH private key for pushing to stick-kdoc'
    required: true
